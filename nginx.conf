# Configuración Nginx para Radiesse Landing Page - Clínica Renové
# Archivo de configuración del servidor para optimización y seguridad

server {
    listen 80;
    listen [::]:80;
    server_name tudominio.com www.tudominio.com;
    
    # Redireccionar HTTP a HTTPS (descomenta si tienes SSL)
    # return 301 https://$server_name$request_uri;
}

server {
    # Configuración HTTPS (ajustar según tu certificado SSL)
    # listen 443 ssl http2;
    # listen [::]:443 ssl http2;
    
    # Para HTTP sin SSL, usa estas líneas en su lugar:
    listen 80;
    listen [::]:80;
    
    server_name tudominio.com www.tudominio.com;
    
    # Configuración SSL (descomenta y ajusta si tienes certificado)
    # ssl_certificate /path/to/your/certificate.crt;
    # ssl_certificate_key /path/to/your/private.key;
    # ssl_protocols TLSv1.2 TLSv1.3;
    # ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384;
    # ssl_prefer_server_ciphers off;
    
    # Directorio raíz del sitio
    root /var/www/html/radiesse;
    index index.html;
    
    # Configuración de logs
    access_log /var/log/nginx/radiesse_access.log;
    error_log /var/log/nginx/radiesse_error.log;
    
    # Configuración de compresión GZIP
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied expired no-cache no-store private must-revalidate auth;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/javascript
        application/xml+rss
        application/json
        image/svg+xml;
    
    # Configuración de caché para archivos estáticos
    location ~* \.(css|js|png|jpg|jpeg|gif|ico|svg|webp|woff|woff2|ttf|eot)$ {
        expires 1M;
        add_header Cache-Control "public, immutable";
        add_header Vary Accept-Encoding;
        access_log off;
    }
    
    # Configuración para HTML
    location ~* \.(html|htm)$ {
        expires 1h;
        add_header Cache-Control "public";
        add_header Vary Accept-Encoding;
    }
    
    # Página principal
    location / {
        try_files $uri $uri/ /index.html;
        
        # Headers de seguridad
        add_header X-Frame-Options "DENY" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header Referrer-Policy "strict-origin-when-cross-origin" always;
        
        # Content Security Policy
        add_header Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' cdn.tailwindcss.com; style-src 'self' 'unsafe-inline' fonts.googleapis.com cdn.tailwindcss.com; font-src 'self' fonts.gstatic.com; img-src 'self' data: https: clinicarenovespa.com placehold.co; connect-src 'self'; frame-src 'none'; object-src 'none';" always;
    }
    
    # Bloquear acceso a archivos sensibles
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    location ~* \.(md|txt|log)$ {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # Configuración para dispositivos móviles
    location ~* \.(html|htm)$ {
        if ($http_user_agent ~* "(Mobile|Android|iPhone|iPad)") {
            add_header Vary User-Agent;
        }
        try_files $uri $uri/ /index.html;
    }
    
    # Redireccionar www a no-www (opcional)
    # if ($host = www.tudominio.com) {
    #     return 301 https://tudominio.com$request_uri;
    # }
    
    # Configuración de límites
    client_max_body_size 10M;
    client_body_timeout 60s;
    client_header_timeout 60s;
    
    # Configuración de buffers
    client_body_buffer_size 128k;
    client_header_buffer_size 1k;
    large_client_header_buffers 4 4k;
    
    # Página de error personalizada (opcional)
    # error_page 404 /404.html;
    # error_page 500 502 503 504 /50x.html;
    
    # Configuración adicional para WhatsApp
    location ~* /whatsapp {
        return 301 "https://api.whatsapp.com/send?phone=528447804399&text=Hola,%20vengo%20de%20la%20página%20de%20Radiesse%20y%20quisiera%20más%20información%20sobre%20el%20tratamiento.";
    }
    
    # Configuración para robots.txt (opcional)
    location = /robots.txt {
        add_header Content-Type text/plain;
        return 200 "User-agent: *\nDisallow: /admin/\nSitemap: https://tudominio.com/sitemap.xml\n";
    }
    
    # Configuración para sitemap.xml (opcional)
    # location = /sitemap.xml {
    #     root /var/www/html/radiesse;
    #     add_header Content-Type application/xml;
    # }
}

# Configuración adicional para rate limiting (opcional)
# limit_req_zone $binary_remote_addr zone=radiesse:10m rate=10r/s;
# 
# server {
#     # ... configuración del servidor ...
#     
#     location / {
#         limit_req zone=radiesse burst=20 nodelay;
#         # ... resto de la configuración ...
#     }
# }
